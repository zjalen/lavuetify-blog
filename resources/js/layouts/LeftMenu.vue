<template>
  <v-navigation-drawer
    v-model="show"
    app
    :disable-resize-watcher="true"
    clipped
  >
    <v-list dense>
      <div v-for="(item, index) in menu_list"
           :key="index">
        <v-subheader
          class="mt-4 grey--text text--darken-1">
          {{item.group}}
        </v-subheader>
        <v-list-item-group v-model="item.current" color="primary">
          <v-list-item v-for="(menu, i) in item.children" :key="i" @click="onClick(index, i, menu.sign)" link>
            <v-list-item-action>
              <v-icon>mdi-{{ menu.icon }}</v-icon>
            </v-list-item-action>
            <v-list-item-content>
              <v-list-item-title>{{menu.title}}</v-list-item-title>
            </v-list-item-content>
          </v-list-item>
        </v-list-item-group>
      </div>
    </v-list>

  </v-navigation-drawer>
</template>

<script>
export default {
  name: 'LeftMenu',
  props: {},
  data () {
    return {
      show: false,
      menu_list: [
        {
          group: '前端管理',
          current: null,
          children: [
            {
              title: '首页',
              icon: 'home',
              sign: 'home',
            },
            {
              title: '文章管理',
              icon: 'pencil-outline',
              sign: 'articles',
            },
            {
              title: '评论管理',
              icon: 'message-reply',
              sign: 'comments',
            },
            {
              title: '文章分类',
              icon: 'menu',
              sign: 'categories',
            },
            {
              title: '标签管理',
              icon: 'tag',
              sign: 'tags',
            },
            {
              title: '主题管理',
              icon: 'file-document',
              sign: 'topics',
            },
            {
              title: '页面管理',
              icon: 'newspaper-variant',
              sign: 'pages',
            },
            {
              title: '友链管理',
              icon: 'link',
              sign: 'links',
            },
          ],
        },
        {
          group: '后台管理',
          current: null,
          children: [
            {
              title: '后台菜单',
              icon: 'menu-open',
              sign: 'admin-menu',
            },
          ],
        },
      ],
    }
  },
  mounted () {
    this.show = this.$store.getters.drawer
    this.$VM.$on('switchDrawer', this.onSwitchDrawer)
    this.updateMenuSign()
  },
  computed: {},
  watch: {
    show () {
      this.$store.dispatch('actionSetDrawer', this.show)
    },
    '$route': function () {
      this.updateMenuSign()
    },
  },
  methods: {
    onClick (index, i, sign) {
      this.menu_list.forEach((value, key) => {
        if (key === index) {
          this.menu_list[index].current = i
        }
        else {
          this.menu_list[key].current = null
        }
      })
      if (sign !== this.$route.name) {
        this.$router.push({
          name: sign,
        })
      }
    },
    onSwitchDrawer (val) {
      this.show = val
    },
    updateMenuSign () {
      this.menu_list.forEach((value, key) => {
        value.children.forEach((v, k) => {
          if (v.sign === this.$route.name) {
            this.menu_list[key].current = k
          }
        })
      })
    },
  },
}
</script>

<style scoped>

</style>
